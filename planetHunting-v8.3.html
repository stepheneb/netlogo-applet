<html>
<head>
<title>planetHunting-v8.3</title>
<style type="text/css">
<!--
  :link { color: rgb(110, 0, 110); } 
  :visited { color: rgb(110, 0, 110); } 
  body { margin-left: 5px; font-family: arial, sans-serif; 
         background: white; font-size: 12pt } 
  h2 { background: rgb(166,172,255); 
       font-size: 15pt; 
       padding-left: 6px; padding-right: 6px; padding-top: 6px; 
       padding-bottom: 6px; } 
  p { margin-left: 10px; } 
  pre { margin-left: 13px; background: rgb(225,225,225); 
        font-family: monospace; padding-left: 3px; padding-right: 3px; 
        padding-top: 3px; padding-bottom: 3px; } 
-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 4.1.2.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p><hr>

<p><font size="-1">In order for this to work, this file, your model file
(planetHunting-v8.3.nlogo), and the file NetLogoLite.jar
must all be in the same directory.  (You can copy NetLogoLite.jar
from the directory where you installed NetLogo.)</font></p>

<p><font size="-1">On some systems, you can test the applet locally on your computer
before uploading it to a web server.  It doesn't work on all systems,
though, so if it doesn't work from your hard drive, please try
uploading it to a web server.</font></p>

<p><font size="-1">You don't need to include everything in this file in your page.
If you want, you can just take the HTML code beginning with
&lt;applet&gt; and ending with &lt;/applet&gt;, and paste it into any HTML
file you want.  It's even OK to put multiple &lt;applet&gt; tags
on a single page.</font></p>

<p><font size="-1">If NetLogoLite.jar and your model are in different
directories, you must modify the archive= and value= lines
in the HTML code to point to their actual locations.
(For example, if you have multiple applets in different
directories on the same web server, you may want to put 
a single copy of NetLogoLite.jar in one central place and
change the archive= lines of all the HTML files to point
to that one central copy.  This will save disk space for
you and download time for your users.)</font></p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="873" height="601">
  <param name="DefaultModel"
         value="planetHunting-v8.3.nlogo">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="planetHunting-v8.3.nlogo">planetHunting-v8.3.nlogo</a>
</p>
<h2>WHAT IS IT?</h2>
<p>This software allows you to explore how star-planet systems outside the solar system can be identified. It allows you to create different planets orbiting a star like our sun. These systems can be identified from Earth in two ways:</p>
<p>1) The wobble that the planet causes in the star can be detected. This involves detecting slight changes in the location of spectral lines in the light from the star due to the Doppler shift caused by the wobble. <br>2) Dimming of the light from the star when the planet passes in front of the star, called a transit or occultation. </p>
<p>This software calculates both these signals for any size of any orbiting planet—the wobble and the drop of light level. </p>
<p>Real instruments on Earth cannot necessarily see these signals because any measurement necessarily is accompanied by noise—unwanted random variations in the signal. One way to reduce this noise is to use a bigger, more precise telescope. This model allows you to see the signal without noise and with an amount of noise that depends on the precision of the telescope. </p><br>
<h2>HOW TO USE IT</h2>
<p>Press Run/Pause to start. You will see an earth-like planet orbiting a star. You can leave this button in the “Run” position. </p>
<p>You can drag the cursor over the grid to change the viewing angle while the planet orbits. You can look at the system straight down, edge on or anything between. </p>
<p>When the planet passes in front of the star, a magnified insert pops up and the model slows way down so you can see the transit. Earth is too small to see at this scale, but slide the planet diameter slider up to 4.5 or larger, an you can see the planet to scale during the transit. Note that the simulation speed is automatically slowed down during the transit--otherwise it would be too fast to see.</p>
<p>If you select a large diameter planet, you can see the star wobbling, too. The simulation shows both the planet and star orbiting around the center of mass.</p>
<p>All the time you are playing, the two graphs are busy. The result can be a mess because of noise. Turn off 'noise?' (just below the graph) and click on 'Reset Graphs' (also below). Now you can see what the graphs would look like if there was no noise. Too bad scientists don’t have a noise switch like this!!</p>
<p>The upper graph shows the &quot;proper&quot; motion of the star--that is the motion away from you, the viewer. Note that if you look straight down on the grid (drag your mouse downward) there is no proper motion--the graph is flat. Do you understand why?</p>
<p>For most planets and viewing angles, the upper graph goes up and down as the planet orbits. But look at the scale. The actual amplitude can vary enormously. Earth gives 2e-5. A monster planet 50x Earth's diameter (125,000 x its mass) gives an amplitude of 2.5, more than 100,000 times larger. The significance of this is apparent if you turn on the noise. The normal Earth is invisible in the noise, but the monster is hardly effected.</p>
<p>The issue here as is common throughout research is the signal-to-noise ratio. You can just about see the signal for a planet 4x the Earth's diameter. Note: reset the graphs each time you change the diameter.</p>
<p>You can explore whether a closer planet would generate a larger signal. To experiment with a different planet, press the “New Planet” button in the lower right. This stops the simulation and allows you to select a preset planet or make one of your own. </p>
<p>You can use the “Preset-Planets” pull-down menu to select a planet and to make your own. Several kinds of planets have been pre-loaded that you use to explore the signals they would make. </p>
<p>If you select “None. Set with mouse.” This automatically sets a straight-down view and allows you to use the mouse to move the planet or the tip of its velocity vector. It is sometimes hard to select a velocity that doesn’t cause the planet to zoom away or crash into the sun. To simplify this, there is a 'Make circular' that generates a velocity that gives a circular orbit.</p>
<p>You can also change the “Distance-to-star” to make planets with small or large orbits. It is easy to loose the planet off-screen if you are not careful. If the planet is lost, you can always hit 'reset' to start over or use the Preset-Planets button</p>
<p>The lower graph shows the star's brightness, which only changes during a transit of the planet. First look at it with no noise and then experiment with orbits and masses that give a signal that you can see.</p><br>
<h2>THINGS TO NOTICE</h2>
<p>By exploring this model, you can answer the following questions:</p>
<p>1. What is the origin of a star’s wobble? What kinds of planet result in the greatest wobble? <br>2. What kinds of planets and inclinations are necessary to detect the wobble?<br>3. Under what conditions is there a drop in star intensity? <br>4. In this model, what is the smallest planet that causes enough wobble to be detected above the noise?<br>5. In this model, what is the smallest planet that causes enough drop in start intensity to be detected above the noise?<br>6. Estimate the fraction of star-planet systems with large planets that we can detect through intensity drop and through wobble? <br>7. Why have most planets detected so far been too large to support life? </p><br>
<h2>CREDITS AND REFERENCES</h2>
<p>Created by Bob Tinker<br>October 2010<br>Design assistance by Dan Damelin<br>This software is available under the GNU open srouce license. </p><br>
<h2>PROCEDURES</h2>
<pre><font color="#007f69">globals</font><font color="#000000"> [
  insert-on?   </font><font color="#5a5a5a">; tells whether the insert is visible--only happens for an occultation</font><font color="#000000">
  insert-size  </font><font color="#5a5a5a">; tells the size of the square insert</font><font color="#000000">
  old-simulation-speed </font><font color="#5a5a5a">; used to store simulation-speed while slowed down for occultation</font><font color="#000000">
  G            </font><font color="#5a5a5a">; the universal constant in HKS units </font><font color="#000000">
  star-diameter
</font><font color="#5a5a5a">;  star-mass</font><font color="#000000">
  AU 
  sec/yr
  radial-v-data                                </font><font color="#5a5a5a">; a list of radial-velocity points each store-interval</font><font color="#000000">
  store-interval                               </font><font color="#5a5a5a">; the number of seconds between data points in radial-v-data</font><font color="#000000">

  mouse-was-up?                                </font><font color="#5a5a5a">; needed to call once when the mouse is first clicked</font><font color="#000000">
  mousex  mousey                               </font><font color="#5a5a5a">; cumulative motion of the mouse</font><font color="#000000">
  starting-mousex  starting-mousey             </font><font color="#5a5a5a">; starting location of the mouse for the current drag</font><font color="#000000">
  phi theta                                    </font><font color="#5a5a5a">; the rotation and tilt of the scene</font><font color="#000000">
  dist                                         </font><font color="#5a5a5a">; the distance from the observer to the star</font><font color="#000000">
  old-distance                                 </font><font color="#5a5a5a">; stores the old distance to the star</font><font color="#000000">
  grid-size
  scale                                        </font><font color="#5a5a5a">; the number of patches per AU </font><font color="#000000">
  old-theta                                    </font><font color="#5a5a5a">; these remember the angles when a mouse drag event started</font><font color="#000000">
  old-phi 

  slow-speed                                   </font><font color="#5a5a5a">; simulation speed during occultation</font><font color="#000000">
  star new-planet the-arrowhead                </font><font color="#5a5a5a">; will store the who of these objects</font><font color="#000000">
  delta-t                                      </font><font color="#5a5a5a">; the integration step size in years</font><font color="#000000">
  first-step?                                  </font><font color="#5a5a5a">; when the integration starts, it taks a half-step. This tells whether any step is the first. </font><font color="#000000">
  bread-crumb-lifetime                                 </font><font color="#5a5a5a">; the number of years bread-crumbs last</font><font color="#000000">
  elapsed-time                                 </font><font color="#5a5a5a">; the total amount of time since the last planet-making </font><font color="#000000">
  last-bread-crumb-time                                </font><font color="#5a5a5a">; the last time a bread-crumb was left behind</font><font color="#000000">
  time/bread-crumb                                     </font><font color="#5a5a5a">; how often bread-crumbs are created</font><font color="#000000">
  v-scale                                      </font><font color="#5a5a5a">; scales the velocity vector so that a velocity of v shows as v-scale * v  distance in the grid</font><font color="#000000">
</font><font color="#5a5a5a">;  old-change-planet</font><font color="#000000">
  last-plot-time
  brightness
  new-planet-flag
  planet-mass
  ]

</font><font color="#660096">breed</font><font color="#000000"> [spots]                                 </font><font color="#5a5a5a">; grid end-points are used to make the grid</font><font color="#000000">
</font><font color="#660096">breed</font><font color="#000000"> [arrowheads arrowhead]                  </font><font color="#5a5a5a">; used for velocity vector</font><font color="#000000">
</font><font color="#660096">breed</font><font color="#000000"> [bread-crumbs]                          </font><font color="#5a5a5a">; used to mark where the planet has been</font><font color="#000000">
</font><font color="#660096">breed</font><font color="#000000"> [planets planet]
</font><font color="#660096">breed</font><font color="#000000"> [insert-background]
</font><font color="#660096">breed</font><font color="#000000"> [insert-star]
</font><font color="#660096">breed</font><font color="#000000"> [insert-planet]


</font><font color="#007f69">planets-own</font><font color="#000000"> [x-cor y-cor vx vy mass phase w-cor w-vel]  </font><font color="#5a5a5a">; the x-y pairs are measured in AU w-cor is measured in screen coords</font><font color="#000000">
</font><font color="#007f69">spots-own</font><font color="#000000"> [xs ys]                              </font><font color="#5a5a5a">; the x-y pairs are measured in AU</font><font color="#000000">
</font><font color="#007f69">bread-crumbs-own</font><font color="#000000"> [xd yd age]                           </font><font color="#5a5a5a">; as they age, they fade away and eventually die</font><font color="#000000">
</font><font color="#007f69">arrowheads-own</font><font color="#000000"> [xa ya]                         </font><font color="#5a5a5a">; the problem coordinats of the arrowhead</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> startup
  </font><font color="#0000aa">ca</font><font color="#000000">
  </font><font color="#5a5a5a">;  set startup variable values</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> insert-on? </font><font color="#963700">false</font><font color="#000000">                         </font><font color="#5a5a5a">; code stest this true around occulations</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> insert-size </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">            </font><font color="#5a5a5a">; the patch size of the insert square-- 1/3 of the vertical height</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> G </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">5.922e-5</font><font color="#000000">                           </font><font color="#5a5a5a">; the universal gravitational constant in AU, years, and earth-mass units</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> AU </font><font color="#963700">1.5e8</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> star-diameter </font><font color="#963700">1.39e6</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> AU                </font><font color="#5a5a5a">; the star's diameter in AU    </font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> sec/yr </font><font color="#963700">3.16e7</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> store-interval </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">365.12</font><font color="#000000">                </font><font color="#5a5a5a">; a day in years </font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> radial-v-data [ ]                        </font><font color="#5a5a5a">; this declares it as a list</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> slow-speed </font><font color="#963700">.5</font><font color="#000000">                             </font><font color="#5a5a5a">; simulation speed during occultation</font><font color="#000000">
  
  </font><font color="#0000aa">set</font><font color="#000000"> phi </font><font color="#963700">15</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">65</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> scale </font><font color="#963700">100</font><font color="#000000">                                </font><font color="#5a5a5a">; in units of patches per AU</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> grid-size </font><font color="#963700">5</font><font color="#000000">                              </font><font color="#5a5a5a">; total distance from left to right (and top to bottom) of grid</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> old-distance </font><font color="#963700">10</font><font color="#000000">                          </font><font color="#5a5a5a">; distance to observer (always 2x grid size for reasonable distortion) </font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">10</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> old-simulation-speed </font><font color="#963700">1</font><font color="#000000">
  
  </font><font color="#0000aa">set</font><font color="#000000"> mouse-was-up? </font><font color="#963700">true</font><font color="#000000">

  
  </font><font color="#0000aa">set</font><font color="#000000"> delta-t  </font><font color="#963700">.000003</font><font color="#000000">                         </font><font color="#5a5a5a">; the integration step size in years (gets multiplied by the simulation-speed which goes from 0 to 100. </font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> first-step? </font><font color="#963700">true</font><font color="#000000">                         </font><font color="#5a5a5a">; makes the first integration step a half-step. </font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> bread-crumb-lifetime  </font><font color="#963700">3</font><font color="#000000">                          </font><font color="#5a5a5a">; the number of years bread-crumbs last</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> elapsed-time </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> time/bread-crumb </font><font color="#963700">.05</font><font color="#000000">                             </font><font color="#5a5a5a">; the time between bread-crumbs</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> v-scale </font><font color="#963700">.3</font><font color="#000000">                               </font><font color="#5a5a5a">; a multiplier of v to determine the lenght of the velocity vector</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> new-planet-flag </font><font color="#963700">false</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> last-plot-time </font><font color="#963700">0</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> brightness </font><font color="#963700">1</font><font color="#000000">                             </font><font color="#5a5a5a">; default brightness of the star</font><font color="#000000">
  
  </font><font color="#5a5a5a">; create various turtles</font><font color="#000000">
  create-planets </font><font color="#963700">2</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"> ]       </font><font color="#5a5a5a">; create two 'planets' first</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> star </font><font color="#660096">turtle</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">                            </font><font color="#5a5a5a">; whichever has who=0 is called star</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> new-planet </font><font color="#660096">turtle</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">                      </font><font color="#5a5a5a">; whichever has who=1 is called new-planet</font><font color="#000000">
  create-arrowheads </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;default&quot;</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> </font><font color="#0000aa">ht</font><font color="#000000">]
  </font><font color="#0000aa">set</font><font color="#000000"> the-arrowhead </font><font color="#660096">turtle</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">

  create-insert-background </font><font color="#963700">1</font><font color="#000000"> [ 
    </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ) (</font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> )
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;frame&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000">  insert-size 
    </font><font color="#0000aa">ht</font><font color="#000000">]                                         </font><font color="#5a5a5a">; hide for the time being </font><font color="#000000">
  create-insert-star </font><font color="#963700">1</font><font color="#000000"> [
    </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ) (</font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> )
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000"> 
    </font><font color="#0000aa">ht</font><font color="#000000"> ]
  create-insert-planet </font><font color="#963700">1</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle 2&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000"> 
    </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ) (</font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ) 
    </font><font color="#0000aa">ht</font><font color="#000000"> ]

  new-grid grid-size                             </font><font color="#5a5a5a">; creates the grid but doesn't show it</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> bread-crumbs [</font><font color="#0000aa">ht</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label-color</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000"> ]
  </font><font color="#0000aa">set</font><font color="#000000"> dist distance-to-star
  
  </font><font color="#0000aa">ask</font><font color="#000000"> star [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> mass </font><font color="#963700">1.99e30</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">5.97e24</font><font color="#000000">  
    </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> 
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label</font><font color="#000000"> </font><font color="#963700">&quot;Star &quot;</font><font color="#000000"> ]
  </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [
    </font><font color="#0000aa">create-links-with</font><font color="#000000"> arrowheads
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> 
    </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">.707</font><font color="#000000">                               </font><font color="#5a5a5a">; place it about 1/8 around an orbit</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">.707</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">pi</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">.707</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> vy </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">pi</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">.707</font><font color="#000000">                          </font><font color="#5a5a5a">; in astronomical units per year. At r = 1 it travels 2pi AU per year</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> loc (screen-coords x-cor y-cor)
    </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">first</font><font color="#000000"> loc   </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> loc
    </font><font color="#0000aa">if</font><font color="#000000"> in-view? u v  [ </font><font color="#0000aa">setxy</font><font color="#000000"> u v ]
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label</font><font color="#000000"> </font><font color="#963700">&quot;New Planet&quot;</font><font color="#000000">
    ]
  </font><font color="#0000aa">set</font><font color="#000000"> simulation-speed </font><font color="#963700">50</font><font color="#000000">
  scale-variables distance-to-star  
  update-screen
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> go                                            </font><font color="#5a5a5a">; this is called from a forever button</font><font color="#000000">
  set-planet-mass                                </font><font color="#5a5a5a">; read the diameter slider and rocky planet switch to generate the planet mass</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> new-planet-flag                         </font><font color="#5a5a5a">; make the program modal depending on the &quot;starting-place&quot; switch</font><font color="#000000">
    [ handle-presets 
      </font><font color="#0000aa">set</font><font color="#000000"> first-step? </font><font color="#963700">true</font><font color="#000000"> ]                     </font><font color="#5a5a5a">; when starting a new integration, the first step is special                      </font><font color="#000000">
    [ handle-occultation                         </font><font color="#5a5a5a">; if the user isn't changing the planet, then run the simulation</font><font color="#000000">
      new-angles                                 </font><font color="#5a5a5a">; read the mouse and set theta and phi</font><font color="#000000">
      do-scale-change                            </font><font color="#5a5a5a">; check for scale change</font><font color="#000000">
      step-forward-in-time              
      support-graphs
      </font><font color="#0000aa">set</font><font color="#000000"> first-step? </font><font color="#963700">false</font><font color="#000000">  ]                   </font><font color="#5a5a5a">; reset the first-step detector </font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">
                
</font><font color="#007f69">to</font><font color="#000000"> handle-occultation                            </font><font color="#5a5a5a">; looks for an occultation and sets globals to slow the simulation, show the insert, and warn the user. </font><font color="#000000">
 </font><font color="#0000aa">if</font><font color="#000000"> near-occ? </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> insert-on? [               </font><font color="#5a5a5a">; check for an occultation starting</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> old-simulation-speed simulation-speed
    </font><font color="#0000aa">set</font><font color="#000000"> simulation-speed slow-speed
    </font><font color="#0000aa">set</font><font color="#000000"> insert-on? </font><font color="#963700">true</font><font color="#000000"> 
    </font><font color="#0000aa">output-print</font><font color="#000000"> </font><font color="#963700">&quot;A transit is coming up!!&quot;</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> planet-diameter </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">4.2</font><font color="#000000">  
        [</font><font color="#0000aa">output-print</font><font color="#000000"> </font><font color="#963700">&quot;Watch the insert.&quot;</font><font color="#000000">]
        [</font><font color="#0000aa">output-print</font><font color="#000000"> </font><font color="#963700">&quot;The planet is too small to see.&quot;</font><font color="#000000">]
    </font><font color="#0000aa">output-print</font><font color="#000000"> </font><font color="#963700">&quot;Simulation slowed&quot;</font><font color="#000000"> ]
  </font><font color="#0000aa">if</font><font color="#000000"> insert-on? </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> near-occ? [               </font><font color="#5a5a5a">; check for an occultation ending</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> simulation-speed old-simulation-speed     </font><font color="#5a5a5a">; resume prior speed</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> insert-on? </font><font color="#963700">false</font><font color="#000000">                          </font><font color="#5a5a5a">; remove the insert</font><font color="#000000">
    </font><font color="#0000aa">clear-output</font><font color="#000000"> ]                                </font><font color="#5a5a5a">; remove the message about occultation</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> do-scale-change                                    </font><font color="#5a5a5a">; handles scale changes     </font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> d </font><font color="#963700">0</font><font color="#000000">                                         </font><font color="#5a5a5a">; gives d the scope of this proceedure</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> distance-to-star </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;From Earth&quot;</font><font color="#000000">
    [</font><font color="#0000aa">set</font><font color="#000000"> d </font><font color="#963700">1e4</font><font color="#000000">] [</font><font color="#0000aa">set</font><font color="#000000"> d distance-to-star]         </font><font color="#5a5a5a">; handle string in distance-to-star chooser</font><font color="#000000">
  update-scale d
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-scale [d]                              </font><font color="#5a5a5a">; handles scale change if needed</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> ( old-distance </font><font color="#660096">=</font><font color="#000000"> d)                     </font><font color="#5a5a5a">; check to see whether the distance has changed </font><font color="#000000">
    [                                            </font><font color="#5a5a5a">; go here if there is no change in the distance to star</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> dist d                                 </font><font color="#5a5a5a">; dist is used in 'screen-coords'  This line is probably unnecessary</font><font color="#000000">
      </font><font color="#0000aa">ifelse</font><font color="#000000"> d </font><font color="#660096">&lt;=</font><font color="#000000"> </font><font color="#963700">500</font><font color="#000000"> 
        [ update-screen 
          </font><font color="#0000aa">ask</font><font color="#000000"> spots [</font><font color="#0000aa">st</font><font color="#000000">]
          </font><font color="#0000aa">ask</font><font color="#000000"> arrowheads [</font><font color="#0000aa">st</font><font color="#000000">]
          </font><font color="#0000aa">ask</font><font color="#000000"> bread-crumbs [</font><font color="#0000aa">st</font><font color="#000000">]  
          </font><font color="#0000aa">ask</font><font color="#000000"> planets [</font><font color="#0000aa">st</font><font color="#000000">] 
          </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">links</font><font color="#000000"> [</font><font color="#0000aa">show-link</font><font color="#000000">]
          ]                          </font><font color="#5a5a5a">; draw the grid, only if at 100 AU or close </font><font color="#000000">
        [ </font><font color="#0000aa">ask</font><font color="#000000"> spots [</font><font color="#0000aa">ht</font><font color="#000000">]
          </font><font color="#0000aa">ask</font><font color="#000000"> arrowheads [</font><font color="#0000aa">ht</font><font color="#000000">]
          </font><font color="#0000aa">ask</font><font color="#000000"> bread-crumbs [</font><font color="#0000aa">ht</font><font color="#000000">]  
          </font><font color="#0000aa">ask</font><font color="#000000"> planets [</font><font color="#0000aa">ht</font><font color="#000000">] 
          </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">links</font><font color="#000000"> [</font><font color="#0000aa">hide-link</font><font color="#000000">]
          create-spots </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">st</font><font color="#000000"> </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">]
          ]]                         </font><font color="#5a5a5a">; grid end-points are used to make the grid</font><font color="#000000">

    [                                             </font><font color="#5a5a5a">; user changed view. pan to new value and redraw the grid</font><font color="#000000">
      </font><font color="#0000aa">let</font><font color="#000000"> n </font><font color="#963700">50</font><font color="#000000">                                    </font><font color="#5a5a5a">; in n steps</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> dist old-distance                       </font><font color="#5a5a5a">; starting at the old distance</font><font color="#000000">
      </font><font color="#0000aa">let</font><font color="#000000"> dd ( d </font><font color="#660096">-</font><font color="#000000"> old-distance ) </font><font color="#660096">/</font><font color="#000000"> n             </font><font color="#5a5a5a">; step size</font><font color="#000000">
      </font><font color="#0000aa">ifelse</font><font color="#000000"> dd </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">                               </font><font color="#5a5a5a">; check to see whether the grid is contracting (first option) or expanding (second)</font><font color="#000000">
        [                                         </font><font color="#5a5a5a">; if contracting (getting farther away), pan first, then redraw</font><font color="#000000">
          </font><font color="#0000aa">repeat</font><font color="#000000"> n [                              </font><font color="#5a5a5a">; </font><font color="#000000">
            </font><font color="#0000aa">set</font><font color="#000000"> dist dist </font><font color="#660096">+</font><font color="#000000"> dd                    </font><font color="#5a5a5a">; don't need first step--that's old</font><font color="#000000">
            update-screen
          </font><font color="#0000aa">wait</font><font color="#000000"> </font><font color="#963700">.06</font><font color="#000000"> ]
          </font><font color="#0000aa">set</font><font color="#000000"> old-distance d
          </font><font color="#0000aa">set</font><font color="#000000"> grid-size d </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">                     </font><font color="#5a5a5a">; redraw grid with a size that is half the distance to the star. </font><font color="#000000">
</font><font color="#5a5a5a">;          ask spots [die]                        ; restore this if we hate keeping the smaller grid </font><font color="#000000">
          new-grid grid-size ]
        [                                         </font><font color="#5a5a5a">; if expanding (getting closer) redraw first then pan</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> grid-size d </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">                     </font><font color="#5a5a5a">; redraw grid with a size that is half the distance to the star. </font><font color="#000000">
          </font><font color="#0000aa">ask</font><font color="#000000"> spots [</font><font color="#0000aa">die</font><font color="#000000">]
          new-grid grid-size 
          </font><font color="#0000aa">repeat</font><font color="#000000"> n [                              </font><font color="#5a5a5a">; </font><font color="#000000">
            </font><font color="#0000aa">set</font><font color="#000000"> dist dist </font><font color="#660096">+</font><font color="#000000"> dd                    </font><font color="#5a5a5a">; don't need first step--that's old</font><font color="#000000">
            update-screen
            </font><font color="#0000aa">wait</font><font color="#000000"> </font><font color="#963700">.06</font><font color="#000000"> ]
          </font><font color="#0000aa">set</font><font color="#000000"> old-distance d
        ]                                          </font><font color="#5a5a5a">; end of pan</font><font color="#000000">
    </font><font color="#5a5a5a">; for the new scale, we need new values of time/bread-crumb, bread-crumb-lifetime,  v-scale, and delta-t. They scale as d ^.5</font><font color="#000000">
</font><font color="#5a5a5a">;    scale-variables d</font><font color="#000000">
     ]
</font><font color="#007f69">end</font><font color="#000000">
    
</font><font color="#007f69">to</font><font color="#000000"> scale-variables [d]
    </font><font color="#0000aa">let</font><font color="#000000"> f d </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> bread-crumb-lifetime  </font><font color="#963700">.08</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000">  f            </font><font color="#5a5a5a">; the number of years bread-crumbs last</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> time/bread-crumb </font><font color="#963700">.0006</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000">   f              </font><font color="#5a5a5a">; the time between bread-crumbs in years</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> v-scale </font><font color="#963700">.003</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> f
    </font><font color="#0000aa">set</font><font color="#000000"> delta-t </font><font color="#963700">.0000002</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> f                      </font><font color="#5a5a5a">; the time step, in earth-years                                      </font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000"> 

</font><font color="#007f69">to</font><font color="#000000"> update-screen                                  </font><font color="#5a5a5a">; uses dist, and redraws the star, planet, grid, arrowhead and bread-crumbs.  </font><font color="#000000">
    </font><font color="#0000aa">ask</font><font color="#000000"> spots                                     </font><font color="#5a5a5a">; moves grid end-points using the new value of phi and theta</font><font color="#000000">
      [ </font><font color="#0000aa">st</font><font color="#000000">
        </font><font color="#0000aa">let</font><font color="#000000"> loc screen-coords xs ys
        </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">first</font><font color="#000000"> loc   </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> loc
        </font><font color="#0000aa">ifelse</font><font color="#000000"> in-view? u v 
          [</font><font color="#0000aa">setxy</font><font color="#000000"> u v </font><font color="#0000aa">st</font><font color="#000000">]
          [</font><font color="#0000aa">ht</font><font color="#000000"> ]]
    </font><font color="#0000aa">ask</font><font color="#000000"> planets [
       </font><font color="#0000aa">let</font><font color="#000000"> loc screen-coords x-cor y-cor
       </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">first</font><font color="#000000"> loc   </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> loc
       </font><font color="#0000aa">set</font><font color="#000000"> w-cor </font><font color="#660096">last</font><font color="#000000"> loc                          </font><font color="#5a5a5a">; w-cor is the distance in or out of the screen of the planets in patch units. </font><font color="#000000">

       </font><font color="#0000aa">ifelse</font><font color="#000000"> in-view? u v 
          [</font><font color="#0000aa">setxy</font><font color="#000000"> u v </font><font color="#0000aa">st</font><font color="#000000">]
          [</font><font color="#0000aa">ht</font><font color="#000000"> ]]
    </font><font color="#0000aa">ask</font><font color="#000000"> bread-crumbs [
       </font><font color="#0000aa">let</font><font color="#000000"> loc screen-coords xd yd
       </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">first</font><font color="#000000"> loc   </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> loc
       </font><font color="#0000aa">ifelse</font><font color="#000000"> in-view? u v 
          [</font><font color="#0000aa">setxy</font><font color="#000000"> u v </font><font color="#0000aa">st</font><font color="#000000">]
          [</font><font color="#0000aa">ht</font><font color="#000000"> ]
        </font><font color="#0000aa">set</font><font color="#000000"> age age </font><font color="#660096">+</font><font color="#000000"> delta-t
        </font><font color="#0000aa">if</font><font color="#000000"> age </font><font color="#660096">&gt;</font><font color="#000000"> bread-crumb-lifetime [</font><font color="#0000aa">die</font><font color="#000000">] 
        </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> (bread-crumb-lifetime </font><font color="#660096">-</font><font color="#000000"> age ) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">9.9</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> bread-crumb-lifetime  </font><font color="#5a5a5a">; Starts white, faces to black over bread-crumb-lifetime time. </font><font color="#000000">
          ] 
    </font><font color="#0000aa">ask</font><font color="#000000"> arrowheads [  
        </font><font color="#0000aa">st</font><font color="#000000">
        </font><font color="#0000aa">set</font><font color="#000000"> xa ([x-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet) </font><font color="#660096">+</font><font color="#000000"> v-scale </font><font color="#660096">*</font><font color="#000000"> ([vx] </font><font color="#660096">of</font><font color="#000000"> new-planet)
        </font><font color="#0000aa">set</font><font color="#000000"> ya ([y-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet) </font><font color="#660096">+</font><font color="#000000"> v-scale </font><font color="#660096">*</font><font color="#000000"> ([vy] </font><font color="#660096">of</font><font color="#000000"> new-planet )
        </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">towards-nowrap</font><font color="#000000"> new-planet  
        </font><font color="#0000aa">let</font><font color="#000000"> loc screen-coords xa ya
        </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">first</font><font color="#000000"> loc   </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> loc
        </font><font color="#0000aa">ifelse</font><font color="#000000"> in-view? u v 
          [</font><font color="#0000aa">setxy</font><font color="#000000"> u v </font><font color="#0000aa">st</font><font color="#000000">]
          [</font><font color="#0000aa">ht</font><font color="#000000"> ]]  
    </font><font color="#0000aa">ifelse</font><font color="#000000"> insert-on? </font><font color="#5a5a5a">; support the insert if the insert condition is on</font><font color="#000000">
      [ </font><font color="#0000aa">ask</font><font color="#000000"> insert-star [</font><font color="#0000aa">st</font><font color="#000000">]       </font><font color="#5a5a5a">; turn on the inserts</font><font color="#000000">
        </font><font color="#0000aa">ask</font><font color="#000000"> insert-background [</font><font color="#0000aa">st</font><font color="#000000">]
        </font><font color="#0000aa">ask</font><font color="#000000"> insert-planet [
          </font><font color="#0000aa">st</font><font color="#000000"> 
          </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> (insert-size </font><font color="#660096">*</font><font color="#000000"> planet-diameter ) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">218</font><font color="#000000">   </font><font color="#5a5a5a">; 218 is twice the ratio of sun to earth diameters. Insert-size / 2 is the size of the star</font><font color="#000000">
          </font><font color="#0000aa">let</font><font color="#000000"> x-center </font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">  </font><font color="#5a5a5a">; the center of the insert</font><font color="#000000">
          </font><font color="#0000aa">let</font><font color="#000000"> y-center </font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> 
          </font><font color="#0000aa">let</font><font color="#000000"> u1 [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> new-planet
          </font><font color="#0000aa">let</font><font color="#000000"> u2 [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> star
          </font><font color="#0000aa">let</font><font color="#000000"> v1 [</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> new-planet
          </font><font color="#0000aa">let</font><font color="#000000"> v2 [</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> star
          </font><font color="#0000aa">let</font><font color="#000000"> mag </font><font color="#963700">50</font><font color="#000000"> </font><font color="#5a5a5a">; magnification of the motion of the planet in the insert</font><font color="#000000">
          </font><font color="#0000aa">let</font><font color="#000000"> du mag </font><font color="#660096">*</font><font color="#000000"> (u1 </font><font color="#660096">-</font><font color="#000000"> u2) </font><font color="#5a5a5a">; displacement from center (in insert-screen units)</font><font color="#000000">
          </font><font color="#0000aa">let</font><font color="#000000"> dv mag </font><font color="#660096">*</font><font color="#000000"> (v1 </font><font color="#660096">-</font><font color="#000000"> v2)
          </font><font color="#0000aa">let</font><font color="#000000"> u x-center </font><font color="#660096">+</font><font color="#000000"> du   </font><font color="#5a5a5a">; the insert-planet x-coordinate</font><font color="#000000">
          </font><font color="#0000aa">let</font><font color="#000000"> v y-center </font><font color="#660096">+</font><font color="#000000"> dv   </font><font color="#5a5a5a">; the insert-planet y-coordinate</font><font color="#000000">
          </font><font color="#0000aa">ifelse</font><font color="#000000"> in-insert? u v [</font><font color="#0000aa">st</font><font color="#000000"> </font><font color="#0000aa">setxy</font><font color="#000000"> u v] [</font><font color="#0000aa">ht</font><font color="#000000">]
          </font><font color="#0000aa">ifelse</font><font color="#000000"> (du </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> dv </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">&lt;</font><font color="#000000"> (insert-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> ) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#5a5a5a">; if the planet is inside the star (which is insert-size / 2 in diameter)</font><font color="#000000">
            [</font><font color="#0000aa">set</font><font color="#000000"> brightness </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ( </font><font color="#660096">size</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> insert-size ) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ] </font><font color="#5a5a5a">; the drop in brighhtness is the</font><font color="#000000">
            [</font><font color="#0000aa">set</font><font color="#000000"> brightness </font><font color="#963700">1</font><font color="#000000"> ]                                             </font><font color="#5a5a5a">;    square of the ratio of diameters of the planet and star</font><font color="#000000">
        ]]
      [ </font><font color="#0000aa">ask</font><font color="#000000"> insert-star [</font><font color="#0000aa">ht</font><font color="#000000">]           </font><font color="#5a5a5a">; turn off inserts</font><font color="#000000">
        </font><font color="#0000aa">ask</font><font color="#000000"> insert-background [</font><font color="#0000aa">ht</font><font color="#000000">]
        </font><font color="#0000aa">ask</font><font color="#000000"> insert-planet [</font><font color="#0000aa">ht</font><font color="#000000">]]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> in-insert? [u v]
  </font><font color="#0000aa">ifelse</font><font color="#000000"> u </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> u </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> insert-size
     </font><font color="#660096">and</font><font color="#000000"> v </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> v </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> insert-size 
     [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> ][ </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> ]
</font><font color="#007f69">end</font><font color="#000000">
  

  
</font><font color="#007f69">to-report</font><font color="#000000"> in-view? [u v]        </font><font color="#5a5a5a">;tests to see wherther the point u, v can be seen in the view</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> val ( u </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#660096">min-pxcor</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> u </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">max-pxcor</font><font color="#000000">
    </font><font color="#660096">and</font><font color="#000000"> v </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#660096">min-pycor</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> v </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">max-pycor</font><font color="#000000"> )          </font><font color="#5a5a5a">; tests whether within the screen</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> insert-on?                                </font><font color="#5a5a5a">; further tests are needed if the insert is showing</font><font color="#000000">
    [</font><font color="#0000aa">report</font><font color="#000000"> val </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> in-insert? u v ]
    [</font><font color="#0000aa">report</font><font color="#000000"> val]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> set-planet-mass
  </font><font color="#0000aa">let</font><font color="#000000"> rel-density </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">4.13</font><font color="#000000">                         </font><font color="#5a5a5a">; the relative density of Jupiter compared to Earth</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> rocky-planet [</font><font color="#0000aa">set</font><font color="#000000"> rel-density </font><font color="#963700">1</font><font color="#000000"> ]
  </font><font color="#5a5a5a">;  report the mass in terms of the earth's mass</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> pm rel-density </font><font color="#660096">*</font><font color="#000000"> ( planet-diameter ) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> 
  </font><font color="#0000aa">ifelse</font><font color="#000000"> pm </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">30</font><font color="#000000"> 
     [</font><font color="#0000aa">set</font><font color="#000000"> planet-mass </font><font color="#660096">precision</font><font color="#000000"> pm </font><font color="#963700">2</font><font color="#000000"> ] </font><font color="#5a5a5a">; the planet diameter is in multiples of the earth's diameter. The earth mass is 1 </font><font color="#000000">
     [</font><font color="#0000aa">set</font><font color="#000000"> planet-mass </font><font color="#660096">round</font><font color="#000000"> pm ]       </font><font color="#5a5a5a">; show decimals only for low masses</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [</font><font color="#0000aa">set</font><font color="#000000"> mass pm]  
</font><font color="#007f69">end</font><font color="#000000">   

</font><font color="#007f69">to</font><font color="#000000"> adjust-planet                                   </font><font color="#5a5a5a">; support the mouse as it adjusts the location and speed of the planet</font><font color="#000000">
  scale-variables distance-to-star
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">mouse-inside?</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">mouse-down?</font><font color="#000000"> [                </font><font color="#5a5a5a">; put up velocity vector, support user movements </font><font color="#000000">
             </font><font color="#5a5a5a">; first determine whether the planet or the arrowhead is nearer, then move the nearest</font><font color="#000000">
     </font><font color="#0000aa">let</font><font color="#000000"> loc-planet screen-coords ([x-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet) ([y-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet)   
     </font><font color="#0000aa">let</font><font color="#000000"> loc-arrowhead screen-coords ([xa] </font><font color="#660096">of</font><font color="#000000"> the-arrowhead) ([ya] </font><font color="#660096">of</font><font color="#000000"> the-arrowhead)
     </font><font color="#0000aa">let</font><font color="#000000"> loc-mouse (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">mouse-ycor</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)
     </font><font color="#0000aa">ifelse</font><font color="#000000"> dist-between loc-mouse loc-planet </font><font color="#660096">&lt;</font><font color="#000000"> dist-between loc-mouse loc-arrowhead
        [   </font><font color="#5a5a5a">; do this block if the planet is closest</font><font color="#000000">
            </font><font color="#5a5a5a">; convert the screen coordinates of the mouse to problem cooridinates (x, y)</font><font color="#000000">
            </font><font color="#5a5a5a">; this is simplified because the view is fixed perpendicular to the user. Thus theta is zero and both z and zpp are zero. </font><font color="#000000">
        </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [
          </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">mouse-xcor</font><font color="#000000">  </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">mouse-ycor</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor dist  </font><font color="#660096">*</font><font color="#000000"> (u </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(phi) </font><font color="#660096">+</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(phi)) </font><font color="#660096">/</font><font color="#000000"> scale   </font><font color="#5a5a5a">; this is the inverse transformation from screen coords to problem coords. </font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor dist  </font><font color="#660096">*</font><font color="#000000"> (v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(phi) </font><font color="#660096">-</font><font color="#000000"> u </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(phi)) </font><font color="#660096">/</font><font color="#000000"> scale ]
        </font><font color="#0000aa">ask</font><font color="#000000"> arrowheads [ 
         </font><font color="#0000aa">set</font><font color="#000000"> xa ([x-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet </font><font color="#660096">+</font><font color="#000000"> v-scale </font><font color="#660096">*</font><font color="#000000"> [vx] </font><font color="#660096">of</font><font color="#000000"> new-planet ) 
         </font><font color="#0000aa">set</font><font color="#000000"> ya ([y-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet </font><font color="#660096">+</font><font color="#000000"> v-scale </font><font color="#660096">*</font><font color="#000000"> [vy] </font><font color="#660096">of</font><font color="#000000"> new-planet  )
         </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">towards-nowrap</font><font color="#000000"> new-planet  ]]
        [  </font><font color="#5a5a5a">; do this block if the arrowhead is nearest the cursor </font><font color="#000000">
        </font><font color="#0000aa">ask</font><font color="#000000"> the-arrowhead [
          </font><font color="#0000aa">let</font><font color="#000000"> u </font><font color="#660096">mouse-xcor</font><font color="#000000">  </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#660096">mouse-ycor</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> xa dist  </font><font color="#660096">*</font><font color="#000000"> (u </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(phi) </font><font color="#660096">+</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(phi)) </font><font color="#660096">/</font><font color="#000000"> scale     </font><font color="#5a5a5a">; this is the inverse transformation from screen coords to problem coords. </font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> ya dist  </font><font color="#660096">*</font><font color="#000000"> (v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(phi) </font><font color="#660096">-</font><font color="#000000"> u </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(phi)) </font><font color="#660096">/</font><font color="#000000"> scale 
          </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">towards-nowrap</font><font color="#000000"> new-planet]
        </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [                                           </font><font color="#5a5a5a">; set its vx and vy</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> vx ([xa] </font><font color="#660096">of</font><font color="#000000"> the-arrowhead  </font><font color="#660096">-</font><font color="#000000"> x-cor ) </font><font color="#660096">/</font><font color="#000000"> v-scale
          </font><font color="#0000aa">set</font><font color="#000000"> vy ([ya] </font><font color="#660096">of</font><font color="#000000"> the-arrowhead  </font><font color="#660096">-</font><font color="#000000"> y-cor ) </font><font color="#660096">/</font><font color="#000000"> v-scale
        ]]]
  </font><font color="#5a5a5a">; I should set the sizes of the star and planet here @@@</font><font color="#000000">
  update-screen
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#007f69">to-report</font><font color="#000000"> near-occ?                 </font><font color="#5a5a5a">; Tests for occultation. This will result in showing the insert and slowing the simulation</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> u1 [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> new-planet       </font><font color="#5a5a5a">; xcor is the horizontal screen location</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> u2 [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> star
  </font><font color="#0000aa">let</font><font color="#000000"> v1 [</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> new-planet       </font><font color="#5a5a5a">; xcor is the horizontal screen location</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> v2 [</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> star
  </font><font color="#0000aa">let</font><font color="#000000"> w1 [w-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet      </font><font color="#5a5a5a">; this is the distance in or out of the screen toward the user</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> w2 [w-cor] </font><font color="#660096">of</font><font color="#000000"> star
  </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (v1 </font><font color="#660096">-</font><font color="#000000"> v2) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (u1 </font><font color="#660096">-</font><font color="#000000"> u2)) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">.3</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> w1 </font><font color="#660096">&lt;</font><font color="#000000"> w2 
    [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> ]       </font><font color="#5a5a5a">; if the star and new-planet are near each other</font><font color="#000000">
                         </font><font color="#5a5a5a">;   and the planet is on the observer's side of the star, an occultation is near. </font><font color="#000000">
    [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> ]      </font><font color="#5a5a5a">; </font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> step-forward-in-time 
  </font><font color="#5a5a5a">; moves the planet and star ahead one integration step. Creates bread crumbs. The results are stored in the objects, not shown, yet</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> time-step delta-t </font><font color="#660096">*</font><font color="#000000"> simulation-speed    
  </font><font color="#0000aa">if</font><font color="#000000"> first-step? [
    </font><font color="#0000aa">ask</font><font color="#000000"> star [
      </font><font color="#0000aa">set</font><font color="#000000"> w-cor </font><font color="#660096">last</font><font color="#000000"> screen-coords x-cor y-cor ]      </font><font color="#5a5a5a">; initialize w-cor--used for sun velocity and occultation calculations </font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> last-bread-crumb-time </font><font color="#963700">0</font><font color="#000000">  ]                  </font><font color="#5a5a5a">; initialize the bread-crumb timer </font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [                                    </font><font color="#5a5a5a">; standard Euler integration, but with half-step</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> x-cor x-cor </font><font color="#660096">+</font><font color="#000000"> vx </font><font color="#660096">*</font><font color="#000000"> time-step </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">              </font><font color="#5a5a5a">; move ahead a half-interval, to get a better average x for the acceleration</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> y-cor y-cor </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> time-step </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">  
    </font><font color="#0000aa">let</font><font color="#000000"> factor G </font><font color="#660096">*</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> star </font><font color="#660096">/</font><font color="#000000"> ( x-cor </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> y-cor </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"> 
    </font><font color="#0000aa">let</font><font color="#000000"> ax x-cor </font><font color="#660096">*</font><font color="#000000"> factor                             </font><font color="#5a5a5a">; note G is negative</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> ay y-cor </font><font color="#660096">*</font><font color="#000000"> factor
    </font><font color="#0000aa">set</font><font color="#000000"> vx vx </font><font color="#660096">+</font><font color="#000000"> ax </font><font color="#660096">*</font><font color="#000000"> time-step
    </font><font color="#0000aa">set</font><font color="#000000"> vy vy </font><font color="#660096">+</font><font color="#000000"> ay </font><font color="#660096">*</font><font color="#000000"> time-step
    </font><font color="#0000aa">set</font><font color="#000000"> x-cor x-cor </font><font color="#660096">+</font><font color="#000000"> vx </font><font color="#660096">*</font><font color="#000000"> time-step </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">              </font><font color="#5a5a5a">; move ahead the other half-interval</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> y-cor y-cor </font><font color="#660096">+</font><font color="#000000"> vy </font><font color="#660096">*</font><font color="#000000"> time-step </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">   
    </font><font color="#0000aa">set</font><font color="#000000"> elapsed-time elapsed-time </font><font color="#660096">+</font><font color="#000000"> time-step ]
  </font><font color="#0000aa">if</font><font color="#000000"> last-bread-crumb-time </font><font color="#660096">+</font><font color="#000000"> time/bread-crumb
        </font><font color="#660096">&lt;</font><font color="#000000"> elapsed-time [                               </font><font color="#5a5a5a">; time to create a new bread-crumb</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> last-bread-crumb-time elapsed-time             </font><font color="#5a5a5a">; used to be &quot;last-bread-crumb-time + time/bread-crumb&quot;</font><font color="#000000">
    create-bread-crumbs </font><font color="#963700">1</font><font color="#000000"> [
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;dot&quot;</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">orange</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> age </font><font color="#963700">0</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> xd [x-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet
      </font><font color="#0000aa">set</font><font color="#000000"> yd [y-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet ]]
  </font><font color="#0000aa">ask</font><font color="#000000"> star [
    </font><font color="#0000aa">let</font><font color="#000000"> rho </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> [mass] </font><font color="#660096">of</font><font color="#000000"> new-planet </font><font color="#660096">/</font><font color="#000000"> mass             </font><font color="#5a5a5a">; the ratio of the massses of the star and planet determine the star's distance from 0,0</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> x-cor rho </font><font color="#660096">*</font><font color="#000000"> [x-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet 
    </font><font color="#0000aa">set</font><font color="#000000"> y-cor rho </font><font color="#660096">*</font><font color="#000000"> [y-cor] </font><font color="#660096">of</font><font color="#000000"> new-planet 
    </font><font color="#0000aa">set</font><font color="#000000"> vx rho </font><font color="#660096">*</font><font color="#000000"> [vx] </font><font color="#660096">of</font><font color="#000000"> new-planet
    </font><font color="#0000aa">set</font><font color="#000000"> vy rho </font><font color="#660096">*</font><font color="#000000"> [vy] </font><font color="#660096">of</font><font color="#000000"> new-planet 
    </font><font color="#0000aa">let</font><font color="#000000"> old-w-cor w-cor
    </font><font color="#0000aa">set</font><font color="#000000"> w-cor </font><font color="#660096">last</font><font color="#000000"> screen-coords x-cor y-cor            </font><font color="#5a5a5a">; calculate the apparent motion away from the viewer</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> w-vel (w-cor </font><font color="#660096">-</font><font color="#000000"> old-w-cor ) </font><font color="#660096">/</font><font color="#000000"> time-step
    ]
  </font><font color="#0000aa">ask</font><font color="#000000"> bread-crumbs [</font><font color="#0000aa">set</font><font color="#000000"> age age </font><font color="#660096">+</font><font color="#000000"> time-step ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> select-circular-velocity   </font><font color="#5a5a5a">; reads the current distance and computes a velocity that would result in a circular orbit. </font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [
    </font><font color="#0000aa">let</font><font color="#000000"> x x-cor
    </font><font color="#0000aa">let</font><font color="#000000"> y y-cor
    </font><font color="#0000aa">let</font><font color="#000000"> a </font><font color="#660096">atan</font><font color="#000000"> x y
    </font><font color="#0000aa">let</font><font color="#000000"> d </font><font color="#660096">sqrt</font><font color="#000000"> (x-cor </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> y-cor </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#5a5a5a">; the distance to the CofM. </font><font color="#000000">
    </font><font color="#5a5a5a">; for d = 1, v = 2pi. I think v will scale as sqrt d </font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> v </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">pi</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> d 
    </font><font color="#0000aa">set</font><font color="#000000"> vx </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000"> a
    </font><font color="#0000aa">set</font><font color="#000000"> vy v </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000"> a ]
  update-screen   </font><font color="#5a5a5a">; get the result shown</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> support-graphs
  </font><font color="#5a5a5a">; the radial velocity is stored in the sun as w-vel</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> star [
    </font><font color="#0000aa">ifelse</font><font color="#000000"> first-step?  
      [ </font><font color="#0000aa">clear-all-plots</font><font color="#000000">
        </font><font color="#0000aa">set</font><font color="#000000"> elapsed-time </font><font color="#963700">0</font><font color="#000000">
        </font><font color="#0000aa">set</font><font color="#000000"> last-plot-time </font><font color="#963700">0</font><font color="#000000"> 
        </font><font color="#0000aa">set</font><font color="#000000"> last-bread-crumb-time </font><font color="#963700">0</font><font color="#000000">
</font><font color="#5a5a5a">;        ask bread-crumbs [die]  ; perhaps it is nice to leave the old breadcrumbs to die slowly, so the user can see the old orbit. </font><font color="#000000">
        ]
      [</font><font color="#0000aa">let</font><font color="#000000"> time-step  delta-t </font><font color="#660096">*</font><font color="#000000"> simulation-speed
        </font><font color="#0000aa">let</font><font color="#000000"> plot-interval </font><font color="#963700">.002</font><font color="#000000">
        </font><font color="#0000aa">if</font><font color="#000000"> insert-on? [</font><font color="#0000aa">set</font><font color="#000000"> plot-interval </font><font color="#963700">.0001</font><font color="#000000"> ]
        </font><font color="#0000aa">let</font><font color="#000000"> b brightness
        </font><font color="#0000aa">if</font><font color="#000000"> elapsed-time </font><font color="#660096">&gt;</font><font color="#000000"> last-plot-time </font><font color="#660096">+</font><font color="#000000"> plot-interval [ </font><font color="#5a5a5a">; permits one plotted point every .002 year except during transit </font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> last-plot-time elapsed-time
          </font><font color="#0000aa">let</font><font color="#000000"> v w-vel
          </font><font color="#0000aa">if</font><font color="#000000"> noise? [
            </font><font color="#0000aa">set</font><font color="#000000"> v w-vel </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">.3</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> rand-noise </font><font color="#660096">/</font><font color="#000000"> telescope-precision 
            </font><font color="#0000aa">set</font><font color="#000000"> b brightness </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> rand-noise </font><font color="#660096">/</font><font color="#000000"> telescope-precision ]
          </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Velocity of Star Away From Viewer&quot;</font><font color="#000000">
          </font><font color="#0000aa">plotxy</font><font color="#000000"> elapsed-time  v 
          </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Light Intensity&quot;</font><font color="#000000">
          </font><font color="#0000aa">plotxy</font><font color="#000000"> elapsed-time b ]
      ]]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> handle-presets                                       </font><font color="#5a5a5a">; sets up the planet parameters for the preset condition</font><font color="#000000">

  </font><font color="#0000aa">ifelse</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;None. Set with mouse.&quot;</font><font color="#000000">  
     [ </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">0</font><font color="#000000">                                        </font><font color="#5a5a5a">; force a planar view by calling update once with this angle</font><font color="#000000">
       adjust-planet                                      </font><font color="#5a5a5a">; allow user to adjust the planet </font><font color="#000000">
       do-scale-change  ]       
     [ </font><font color="#0000aa">ask</font><font color="#000000"> new-planet [
        </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Earth&quot;</font><font color="#000000"> [                     </font><font color="#5a5a5a">; remember: mass in earth-masses, distances in AU, time in years</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">                            </font><font color="#5a5a5a">; starts this off 45° around the orbit</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity                        </font><font color="#5a5a5a">; computes vx and vy for a circular orbit at this radius</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">5</font><font color="#000000">                          </font><font color="#5a5a5a">; should be about 5x the orbital radius</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#963700">1</font><font color="#000000">                           </font><font color="#5a5a5a">; the earth is one earth diameter!!</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000">]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Mars&quot;</font><font color="#000000"> [   
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">1.5</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">1.5</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">10</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#660096">precision</font><font color="#000000"> (</font><font color="#963700">.107</font><font color="#000000"> </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">.3333</font><font color="#000000">) </font><font color="#963700">3</font><font color="#000000">       </font><font color="#5a5a5a">; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000">]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Jupiter&quot;</font><font color="#000000"> [ 
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">5.2</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">5.2</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">20</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#660096">precision</font><font color="#000000"> ((</font><font color="#963700">4.13</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">10.5</font><font color="#000000">) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">.3333</font><font color="#000000">) </font><font color="#963700">3</font><font color="#000000">       </font><font color="#5a5a5a">; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">false</font><font color="#000000">]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Venus&quot;</font><font color="#000000"> [   
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">.728</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">.728</font><font color="#000000">  </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">5</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#660096">precision</font><font color="#000000"> (</font><font color="#963700">.815</font><font color="#000000"> </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">.3333</font><font color="#000000">) </font><font color="#963700">3</font><font color="#000000">       </font><font color="#5a5a5a">; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000"> ]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Like Mercury but 10x larger diameter&quot;</font><font color="#000000"> [   
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">.467</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">.467</font><font color="#000000">  </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#660096">precision</font><font color="#000000"> (</font><font color="#963700">55</font><font color="#000000"> </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">.3333</font><font color="#000000">) </font><font color="#963700">3</font><font color="#000000">       </font><font color="#5a5a5a">; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000"> ]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Like Earth but 10x larger diameter&quot;</font><font color="#000000"> [   
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">                            </font><font color="#5a5a5a">; starts this off 45° around the orbit</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity                        </font><font color="#5a5a5a">; computes vx and vy for a circular orbit at this radius</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">5</font><font color="#000000">                          </font><font color="#5a5a5a">; should be about 5x the orbital radius</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#963700">10</font><font color="#000000">                           </font><font color="#5a5a5a">; the earth is one earth diameter!!</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000">]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Earth-like planet near the star&quot;</font><font color="#000000"> [   
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">.2</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">.2</font><font color="#000000">  </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">1</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#963700">1</font><font color="#000000">       </font><font color="#5a5a5a">; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000"> ]
      </font><font color="#0000aa">if</font><font color="#000000"> Preset-planets </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;Large rocky planet very near the star&quot;</font><font color="#000000"> [ 
          </font><font color="#0000aa">set</font><font color="#000000"> x-cor </font><font color="#963700">.1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> y-cor </font><font color="#963700">.1</font><font color="#000000">  </font><font color="#660096">/</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
          select-circular-velocity
          </font><font color="#0000aa">set</font><font color="#000000"> distance-to-star </font><font color="#963700">1</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> planet-diameter </font><font color="#963700">50</font><font color="#000000">      </font><font color="#5a5a5a">; the diameter sets the mass, so this reverses the process, computing the diameter that would get .107 earth masses</font><font color="#000000">
          </font><font color="#0000aa">set</font><font color="#000000"> rocky-planet </font><font color="#963700">true</font><font color="#000000"> ] 
     scale-variables distance-to-star ]]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> rand-noise </font><font color="#5a5a5a">; makes a bell-shaped distribution w/ sd = 1</font><font color="#000000">
  </font><font color="#0000aa">report</font><font color="#000000"> ((</font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> ) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">25</font><font color="#000000"> ) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">15</font><font color="#000000"> </font><font color="#5a5a5a">; a normal distribution around zero with a sd of about 1</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">



</font><font color="#5a5a5a">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</font><font color="#000000">
</font><font color="#5a5a5a">;;;;;;;;;  general mouse rotation proceedures ;;;;;;;;;;;;</font><font color="#000000">
</font><font color="#5a5a5a">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> screen-coords [x y]     </font><font color="#5a5a5a">; given phi, theta, scale, and dist (the distance to the observer in problem units), the grid-size (in problem units) </font><font color="#000000">
                                  </font><font color="#5a5a5a">;         this returns u v in screen coordinates </font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> cphi </font><font color="#660096">cos</font><font color="#000000">(phi)              </font><font color="#5a5a5a">; assuming the sin and cos calculations are slow, these two steps save looking them up twice. </font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> sphi </font><font color="#660096">sin</font><font color="#000000">(phi)
   </font><font color="#0000aa">let</font><font color="#000000"> xpp x </font><font color="#660096">*</font><font color="#000000"> cphi </font><font color="#660096">-</font><font color="#000000"> y </font><font color="#660096">*</font><font color="#000000"> sphi    </font><font color="#5a5a5a">; rotate around the z-axis to the prime coordinates</font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> yp x </font><font color="#660096">*</font><font color="#000000"> sphi </font><font color="#660096">+</font><font color="#000000"> y </font><font color="#660096">*</font><font color="#000000"> cphi
   </font><font color="#0000aa">let</font><font color="#000000"> ypp yp </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">cos</font><font color="#000000">(theta)        </font><font color="#5a5a5a">; rotate around the x-axis to the prime-prime coordinates in which the observer is on the z-axis at infinity. </font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> zpp yp </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">sin</font><font color="#000000">(theta) 
   </font><font color="#0000aa">let</font><font color="#000000"> u scale </font><font color="#660096">*</font><font color="#000000"> xpp </font><font color="#660096">/</font><font color="#000000"> (dist </font><font color="#660096">+</font><font color="#000000"> zpp )      </font><font color="#5a5a5a">; this compensates for distortion for small values of dist</font><font color="#000000">
   </font><font color="#0000aa">let</font><font color="#000000"> v scale </font><font color="#660096">*</font><font color="#000000"> ypp  </font><font color="#660096">/</font><font color="#000000"> (dist </font><font color="#660096">+</font><font color="#000000"> zpp )     </font><font color="#5a5a5a">; scale has units of (patch size) / (problem distance units)   </font><font color="#000000">
</font><font color="#5a5a5a">;   every .2 [output-print (list theta &quot;  &quot; phi)]</font><font color="#000000">
   </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> u v zpp)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> new-angles   </font><font color="#5a5a5a">; supports the mouse and sets new values for the globals theta and phi</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">mouse-down?</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">mouse-inside?</font><font color="#000000"> [         </font><font color="#5a5a5a">; ignore if the mouse is not down inside the view</font><font color="#000000">
    </font><font color="#0000aa">if</font><font color="#000000"> mouse-was-up? [                       </font><font color="#5a5a5a">; detect the first time the mouse is clicked</font><font color="#000000">
       </font><font color="#0000aa">set</font><font color="#000000"> mouse-was-up? </font><font color="#963700">false</font><font color="#000000">               </font><font color="#5a5a5a">; reset the mouse-was-up? logical                  </font><font color="#000000">
       </font><font color="#0000aa">set</font><font color="#000000"> starting-mousex </font><font color="#660096">mouse-xcor</font><font color="#000000">        </font><font color="#5a5a5a">; set the starting location of the mouse from which changes will be accumulated</font><font color="#000000">
       </font><font color="#0000aa">set</font><font color="#000000"> starting-mousey </font><font color="#660096">mouse-ycor</font><font color="#000000">
       </font><font color="#0000aa">set</font><font color="#000000"> old-phi phi                       </font><font color="#5a5a5a">; remember the theta and phi when the mouse was pressed</font><font color="#000000">
       </font><font color="#0000aa">set</font><font color="#000000"> old-theta theta]
    </font><font color="#0000aa">let</font><font color="#000000"> dmx </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> starting-mousex      </font><font color="#5a5a5a">; the amount added this mouse-down is (mouse-xcor - starting-mousex)</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> dmy </font><font color="#660096">mouse-ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> starting-mousey
    </font><font color="#0000aa">set</font><font color="#000000"> phi old-phi </font><font color="#660096">+</font><font color="#000000"> dmx </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">360</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">min-pxcor</font><font color="#000000">)   </font><font color="#5a5a5a">; this gives a 360 rotation for a movement across the view</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> theta old-theta </font><font color="#660096">+</font><font color="#000000"> dmy </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">180</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> (</font><font color="#660096">max-pycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">min-pycor</font><font color="#000000">)   </font><font color="#5a5a5a">; this gives a 180 rotation for a movement up or down the view</font><font color="#000000">
    </font><font color="#0000aa">if</font><font color="#000000"> theta </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> [</font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">90</font><font color="#000000">]              </font><font color="#5a5a5a">; constrain theta to between 0 and 90</font><font color="#000000">
    </font><font color="#0000aa">if</font><font color="#000000"> theta </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> theta </font><font color="#963700">0</font><font color="#000000"> ]
    ]   
 </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">mouse-down?</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> mouse-was-up?) [ </font><font color="#5a5a5a">; detect the first time the mouse was released after being down</font><font color="#000000">
   </font><font color="#0000aa">set</font><font color="#000000"> mouse-was-up? </font><font color="#963700">true</font><font color="#000000"> ]                   </font><font color="#5a5a5a">; set the mouse-was-up? logical</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> new-grid [dia]              </font><font color="#5a5a5a">; creates a 10x10 grid of total extent dia. Grid spacing is dia/10</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> rad dia </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> spacing dia </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000">         </font><font color="#5a5a5a">; Grid spacing is dia/10</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> x </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad              </font><font color="#5a5a5a">; first make grid lines parallel to the x-axis</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> y </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad
    </font><font color="#0000aa">let</font><font color="#000000"> s </font><font color="#963700">false</font><font color="#000000">       </font><font color="#5a5a5a">; show every other grid label</font><font color="#000000">
    </font><font color="#0000aa">while</font><font color="#000000"> [x </font><font color="#660096">&lt;=</font><font color="#000000"> rad] [
      create-spots </font><font color="#963700">1</font><font color="#000000"> [
        </font><font color="#0000aa">set</font><font color="#000000"> xs x 
        </font><font color="#0000aa">set</font><font color="#000000"> ys y
        </font><font color="#0000aa">if</font><font color="#000000"> s [
          </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label</font><font color="#000000"> </font><font color="#660096">precision</font><font color="#000000"> x </font><font color="#963700">2</font><font color="#000000">]
        </font><font color="#0000aa">set</font><font color="#000000"> s </font><font color="#660096">not</font><font color="#000000"> s
        ]  </font><font color="#5a5a5a">; toggle show-label</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> x x </font><font color="#660096">+</font><font color="#000000"> spacing ]
    </font><font color="#0000aa">set</font><font color="#000000"> x </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad
    </font><font color="#0000aa">set</font><font color="#000000"> y rad
    </font><font color="#0000aa">while</font><font color="#000000"> [x </font><font color="#660096">&lt;=</font><font color="#000000"> rad] [
      create-spots </font><font color="#963700">1</font><font color="#000000"> [
        </font><font color="#0000aa">set</font><font color="#000000"> xs x 
        </font><font color="#0000aa">set</font><font color="#000000"> ys y 
        </font><font color="#0000aa">create-links-with</font><font color="#000000"> spots </font><font color="#660096">with</font><font color="#000000"> [xs </font><font color="#660096">=</font><font color="#000000"> x </font><font color="#660096">and</font><font color="#000000"> ys </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad]]
      </font><font color="#0000aa">set</font><font color="#000000"> x x </font><font color="#660096">+</font><font color="#000000"> spacing ]
    
    </font><font color="#0000aa">set</font><font color="#000000"> x </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad
    </font><font color="#0000aa">set</font><font color="#000000"> y </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad
    </font><font color="#0000aa">set</font><font color="#000000"> s </font><font color="#963700">false</font><font color="#000000">       </font><font color="#5a5a5a">; show every other grid label</font><font color="#000000">
    </font><font color="#0000aa">while</font><font color="#000000"> [y </font><font color="#660096">&lt;=</font><font color="#000000"> rad] [
      create-spots </font><font color="#963700">1</font><font color="#000000"> [
        </font><font color="#0000aa">set</font><font color="#000000"> xs x 
        </font><font color="#0000aa">set</font><font color="#000000"> ys y
        </font><font color="#0000aa">if</font><font color="#000000"> s [
          </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label</font><font color="#000000"> </font><font color="#660096">precision</font><font color="#000000"> y </font><font color="#963700">2</font><font color="#000000"> ]
        </font><font color="#0000aa">set</font><font color="#000000"> s </font><font color="#660096">not</font><font color="#000000"> s
        </font><font color="#0000aa">set</font><font color="#000000"> y y </font><font color="#660096">+</font><font color="#000000"> spacing ]]
    </font><font color="#0000aa">set</font><font color="#000000"> x rad
    </font><font color="#0000aa">set</font><font color="#000000"> y </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad
    </font><font color="#0000aa">while</font><font color="#000000"> [y </font><font color="#660096">&lt;=</font><font color="#000000"> rad] [
      create-spots </font><font color="#963700">1</font><font color="#000000"> [
        </font><font color="#0000aa">set</font><font color="#000000"> xs x 
        </font><font color="#0000aa">set</font><font color="#000000"> ys y 
        </font><font color="#0000aa">create-links-with</font><font color="#000000"> spots </font><font color="#660096">with</font><font color="#000000"> [xs </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> rad </font><font color="#660096">and</font><font color="#000000"> ys </font><font color="#660096">=</font><font color="#000000"> y]]
      </font><font color="#0000aa">set</font><font color="#000000"> y y </font><font color="#660096">+</font><font color="#000000"> spacing ]
      </font><font color="#0000aa">ask</font><font color="#000000"> spots [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">.01</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label-color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000">]  </font><font color="#5a5a5a">; I don't care about the spots, just the lines between them</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> dist-between [a b]   </font><font color="#5a5a5a">; a and b are lists of x, y, z values; z is ignored</font><font color="#000000">
  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">sqrt</font><font color="#000000"> ((</font><font color="#660096">first</font><font color="#000000"> a </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">first</font><font color="#000000"> b) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> a </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> b) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
</font><font color="#007f69">end</font><font color="#000000">
</font>
</pre>

</body>
</html>
